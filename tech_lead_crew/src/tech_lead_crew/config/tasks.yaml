analyze_and_extract:
  description: >
    ðŸ” Analyzing Jira issue and extracting requirements in one pass. Use the input "jira_issue_key" (e.g., "TECBAC-209").

    Call the jira_get_issue tool exactly once. If it fails, report the failure and stop; do NOT retry.

    From the Jira response, extract:
    - Issue key and title
    - Description and acceptance criteria
    - Repository location (if specified in task description or links)
    - Project information and project key
    - Constraints, dependencies, or specifications
    - Bitbucket workspace/project key (extract from URLs or use Jira project key as fallback)

    If a repository is mentioned in the Jira issue:
    - Extract the workspace value from the Bitbucket URL or use Jira project key as fallback
    - ALWAYS try to use Bitbucket MCP tools (listRepositories, listRepositoryFiles) to analyze repository structure
    - Only if the tool calls actually fail (return an error), then mention: "âš ï¸ Note: Bitbucket MCP server was unavailable during analysis. Repository file structure could not be retrieved. Analysis is based on Jira issue data and extracted repository metadata only."
    - If MCP tools work successfully, identify project type (frontend, backend, infrastructure, etc.) from repository structure
    - If MCP tools fail, infer project type from Jira issue description and repository name/context
    - Focus on structure and type, NOT code patterns or implementation details

    Then produce:
    - Deliverables (WHAT to create/modify)
    - Required functionality (behaviors/capabilities)
    - Input/Output specifications
    - Constraints and validations
    - Integration requirements (external systems/APIs/components)
    - Repository Context: Project type and basic structure (if repository was analyzed). If Bitbucket MCP was unavailable, explicitly state this limitation.

    Do NOT include implementation details or code-level guidance. Focus on WHAT, not HOW.
  expected_output: >
    A combined issue summary and requirements extraction with the fields listed above, with no additional tool calls beyond the single jira_get_issue invocation.
  agent: tech_lead_crew
